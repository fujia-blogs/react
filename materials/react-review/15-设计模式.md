# React 设计模式

1. 谈论 react 设计模式时，实际上是在谈论“react 组件的设计模式”

- HOC
- Render Props
- 剥离有状态组件和无状态组件

2. Why Hooks：设计模式解决不了所有的问题

就 React 来说，无论是高阶组件，还是 render props，两者的出现都是为了弥补类组件在“逻辑复用”这个层面的不灵活性。它们各自都有着自己的不足，这些不足包括但不限于以下几点：

- 嵌套地狱问题，当嵌套层级过多后，数据源的追溯会变得十分困难

- 较高的学习成本

- props 属性命名冲突问题

## 问答

Q1：设计模式是否是万能的？如果不是，那么对框架来说，还有没有更加深刻、彻底的解决呢？

Q2：高阶组件和 render props 都能复用逻辑，那个更好？

**render props 是更好的选择，因为它更灵活。**

render props 和高阶组件一个非常重要的区别，在于对数据的处理上：在高阶组件中，目标组件对于数据的获取没有主动权，**数据的分发逻辑全部收敛在高阶组件的内部；**而在 render props 中，除了父组件可以对数据进行分发处理之外，**子组件也可以选择性地对数据进行接收。**

## 基础

### HOC

1. hoc 是 react 中用于复用组件逻辑的一种高级技巧。hoc 自身不是 react api 的一部分，它是一种基于 react 的组合特性而形成的设计模式 - react 官方

2. 定义：本质是一个函数，参数为组件，返回值为新组件。

3. 高阶组件可以帮助我们从根本上减少重复的编写和修改工作，这不仅是高阶组件这一种模式的利好，更是“逻辑复用”这件事情的意义所在。

### render props

1. 术语"render props"是指一种在 react 组件使用一种值为函数的 prop 共享代码的简单技术。 --- react 官方

2. 什么是 render props？

- render props 是 react 复用组件逻辑的另一种思路，它在实现上和高阶组件有异曲同工之妙 --- 两者都是把通用的逻辑提取到某一处。
- 区别：主要在使用层面，高阶组件的使用姿态是“函数”包裹“组件”，而 render props 恰恰相反，它强调的是用“组件”包裹“函数”

实现：

```js
const RenderChildren = (props) => {
  return <>{props.children(props)}</>;
};

// 使用
<RenderChildren>{() => <p>RenderChildren的子组件</p>}</RenderChildren>;
```

把握住两个要点：

- render props 的载体应该是一个 React 组件，这一点是与高阶组件不同的（高阶组件本质是函数）；

- render props 组件正常工作的前提是它的子组件需要以函数形式存在。

3. 对于 render props 这种模式来说，函数并不一定要作为子组件传入，它也可以以任意属性名传入，只要 render props 组件可以感知到它就行。

## 要点

1. 软件设计模式中，有一个非常重要的原则叫“开放封闭原则”：

- **一个好的模式，应该尽可能做到对扩展开放，对修改封闭**

2. 单一职责原则又叫“单一功能原则”

- **指的是一个类或模块应该只有且只有一个改变的原因。**

3. 总体来说，“HOC/render props + 类组件”研发模式，还是不够到位。**当设计模式解决不了问题时，我们本能地需要从编程模式上寻找答案。**

4. 在 React 中所看到的 “函数式编程”对“面向对象”的补充（并且大有替代之势），有了今天我们所看到的“一切皆可 Hooks”的大趋势。

5. 一个好的编程模式可以帮助我们节约掉大量“打补丁”式地学习各种组件设计模式的时间。

6. **框架设计越合理，开发者的工作就越轻松。**
